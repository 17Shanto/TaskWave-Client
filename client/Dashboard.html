<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../Styles/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="../Styles/styles.css">
</head>
<body>

    <!-- Nav Bar -->
    <nav class="navbar bg-body-tertiary">
        <div class="container-fluid">
          <h1 style="color: var(--Main-Purple, #635FC7);"><svg class="taskWave-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25" fill="none">
            <rect width="6" height="25" rx="2" fill="#635FC7"/>
            <rect opacity="0.75" x="9" width="6" height="25" rx="2" fill="#635FC7"/>
            <rect opacity="0.5" x="18" width="6" height="25" rx="2" fill="#635FC7"/>
        </svg>TaskWave</h1>

        <!-- <button class="add-new-task-btn"> <span class="add-new-task-text">+Add New Task</span> </button> -->
        <button onclick="logout()" class="btn btn-outline-danger">Logout</button>
        </div>
    </nav>

    <div class="container">
        <div class="row">
          <div class="col-4">
            <h4 style="color: var(--Main-Purple, #635FC7);">All Board (<span id="total-board"></span>)</h4>

            <!-- WorkSpace Naming -->

              <button type="button" class="btn-workSpace" data-bs-toggle="modal" data-bs-target="#createBoardModal" ><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M0.846133 0.846133C0.304363 1.3879 0 2.12271 0 2.88889V13.1111C0 13.8773 0.304363 14.6121 0.846133 15.1538C1.3879 15.6957 2.12271 16 2.88889 16H13.1111C13.8773 16 14.6121 15.6957 15.1538 15.1538C15.6957 14.6121 16 13.8773 16 13.1111V2.88889C16 2.12271 15.6957 1.3879 15.1538 0.846133C14.6121 0.304363 13.8773 0 13.1111 0H2.88889C2.12271 0 1.3879 0.304363 0.846133 0.846133ZM1.33333 13.1111V8.44448H9.77781V14.6667H2.88889C2.03022 14.6667 1.33333 13.9698 1.33333 13.1111ZM9.77781 7.11111V1.33333H2.88889C2.47633 1.33333 2.08067 1.49723 1.78895 1.78895C1.49723 2.08067 1.33333 2.47633 1.33333 2.88889V7.11111H9.77781ZM11.1111 5.77778H14.6667V10.2222H11.1111V5.77778ZM14.6667 11.5555H11.1111V14.6667H13.1111C13.5236 14.6667 13.9194 14.5028 14.2111 14.2111C14.5028 13.9194 14.6667 13.5236 14.6667 13.1111V11.5555ZM14.6667 2.88889V4.44445H11.1111V1.33333H13.1111C13.5236 1.33333 13.9194 1.49723 14.2111 1.78895C14.5028 2.08067 14.6667 2.47633 14.6667 2.88889Z" fill="#635FC7"/>
                </svg> +Create New Board</button>
              
              <!-- Modal -->
              <div class="modal fade" id="createBoardModal" tabindex="-1" aria-labelledby="createBoardModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="createBoardModalLabel">Creating WorkSpace</h1>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <label class="form-label" for="board-name">Task Name</label>
                        <input type="text" id="board-name" class="form-control" />
                        <label class="form-label" for="board-description">Description</label>
                        <input type="text" id="board-description" class="form-control" />
                    </div>
                    <div class="modal-footer">
                      <button type="button" onclick="createNewBoard()" class="add-new-task-btn"> <span class="add-new-task-text">+Create</span> </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Showing All WorkSpace -->
           <div id = "boards" class="">

           </div>
          </div>
          <div class="col-2">
            <button class="new-column-btn">+New Column</button>
          </div>
        </div>
    </div>
    




    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

</body>
<script src="./http.js"></script>
<script>

  function logout()
  {
    window.location.href = `Login.html`
  }
    

  async function createNewBoard(){

    const name = document.getElementById('board-name').value;
    const description = document.getElementById('board-description').value;
    const createdBy = localStorage.getItem('id');

    console.log(name, description, createdBy);
    const response = await request ({name, description, createdBy}, 'workspaces', 'POST');
    console.log(response);
    window.location.href = `DashBoard.html`
  }

  async function deleteWorkSpace(id)
  {
    const url = `http://localhost:3000/api/workspaces/${id}`;
        const response = await fetch(url, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        window.location.href = `DashBoard.html`

  }
  async function updateWorkSpace(id)
  {
      const name =  document.getElementById(`task-name-${id}`).value;
      const description =  document.getElementById(`task-description-${id}`).value;
      const url = `http://localhost:3000/api/workspaces/${id}`;
        const response = await fetch(url, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body:JSON.stringify({
              name: name,
              description: description
            })
        });

        window.location.href = `DashBoard.html`

  }

  async function showAllBoard(){
    // const response = await request(null, `workspace`, 'GET');
        const url = `http://localhost:3000/api/workspaces`;
        const response = await fetch(url, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        const result = await response.json();
        console.log(result);
        const boards = document.getElementById('boards');
        for(w  in result){
          const name = result[w].name;
          const id = result[w]._id;
          const btn = document.createElement('button');
          btn.classList.add('btn-workSpace');

          // View WorkSpace 
          const btn1 = document.createElement('div');
          btn1.classList.add('btn-edit');
         

          btn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M0.846133 0.846133C0.304363 1.3879 0 2.12271 0 2.88889V13.1111C0 13.8773 0.304363 14.6121 0.846133 15.1538C1.3879 15.6957 2.12271 16 2.88889 16H13.1111C13.8773 16 14.6121 15.6957 15.1538 15.1538C15.6957 14.6121 16 13.8773 16 13.1111V2.88889C16 2.12271 15.6957 1.3879 15.1538 0.846133C14.6121 0.304363 13.8773 0 13.1111 0H2.88889C2.12271 0 1.3879 0.304363 0.846133 0.846133ZM1.33333 13.1111V8.44448H9.77781V14.6667H2.88889C2.03022 14.6667 1.33333 13.9698 1.33333 13.1111ZM9.77781 7.11111V1.33333H2.88889C2.47633 1.33333 2.08067 1.49723 1.78895 1.78895C1.49723 2.08067 1.33333 2.47633 1.33333 2.88889V7.11111H9.77781ZM11.1111 5.77778H14.6667V10.2222H11.1111V5.77778ZM14.6667 11.5555H11.1111V14.6667H13.1111C13.5236 14.6667 13.9194 14.5028 14.2111 14.2111C14.5028 13.9194 14.6667 13.5236 14.6667 13.1111V11.5555ZM14.6667 2.88889V4.44445H11.1111V1.33333H13.1111C13.5236 1.33333 13.9194 1.49723 14.2111 1.78895C14.5028 2.08067 14.6667 2.47633 14.6667 2.88889Z" fill="#635FC7"/>
                </svg> ${name} `;


      
        
        const x  = `
        <button type="button" class="btn-edit" data-bs-toggle="modal" data-bs-target="#exampleModal-${id}" >&#10247;</button>
      
      <!-- Modal -->
      <div class="modal fade" id="exampleModal-${id}" tabindex="-1" aria-labelledby="exampleModalLabel-${id}" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel-${id}">Your WorkSpace</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <label class="form-label" for="task-name">Task Name</label>
                <input type="text" value = "${result[w].name}"  id="task-name-${id}" class="form-control" />
                <label class="form-label" for="task-description">Description</label>
                <input type="text" value = "${result[w].description}" id="task-description-${id}" class="form-control" />
            </div>
            <div class="modal-footer d-flex">
              <button type="button" onclick = "deleteWorkSpace('${id}')" class="btn btn-outline-danger"> Delete </button>
              <button type="button" onclick = "updateWorkSpace('${id}')" class="btn btn-outline-success"> Edit </button>
            </div>
          </div>
        </div>
      </div>

        
        `;
        const div =  document.createElement('div');
       div.classList.add('d-flex')
        div.appendChild(btn)
        div.innerHTML += x;
        boards.appendChild(div);
          // console.log(result[w].name)
        }
   
  }

  showAllBoard();
  


</script>
</html>